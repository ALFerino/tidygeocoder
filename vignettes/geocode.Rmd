---
title: "TidyGeocoder Vignette"
output: 
  rmarkdown::html_vignette: default
  github_document:
vignette: >
  %\VignetteIndexEntry{geocode}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

## Dataset for testing
# sample_addresses <- tribble( ~name,~addr,
#                            "White House", "1600 Pennsylvania Ave Washington, DC",
#                            "Transamerica Pyramid", "600 Montgomery St, San Francisco, CA 94111",
#                            NA, "Fake Address",
#                            NA,NA,
#                            "","",
#                            "US City","Nashville,TN",
#                            "Willis Tower", "233 S Wacker Dr, Chicago, IL 60606",
#                            "International City", "Nairobi, Kenya"
#                            )
# save(sample_addresses,file='sample_addresses.RData')
```

The tidygeocoder package provides an intuitive tidyverse-style interface for using geocoder services. Currently the US Census and Nominatim (OSM) services are supported. The US Census service requires a street level address that is located in the United States. The OSM service does not have these restrictions, but has usage limits that will cause you to be locked out of the service temporarily. Because of these usage limits the default service for the `geocode()` function is the US Census which we will use to geocode a few street addresses below.

```{r setup,warning=F,message=F}
library(dplyr)
library(tidygeocoder)
library(knitr)
```

Geocode the addresses in our 'sample_addresses' dataset:

```{r geocode}
lat_longs <- sample_addresses %>% 
  geocode(addr,lat=latitude,long=longitude)
```

Latitude and longitude columns are attached to our input dataset:

```{r display}
kable(lat_longs)
```

Plot our geolocated points

```{r,fig.width=8,fig.height=5}
library(ggplot2)
library(maps)
library(ggrepel)

ggplot(lat_longs %>% filter(!is.na(longitude)), aes(longitude, latitude),color="grey98") +
  borders("state") +
  theme_classic() +
  geom_point() +
  theme(line = element_blank(),
        text = element_blank(),
        title = element_blank()) +
  geom_label_repel(aes(label =name),show.legend=F) +
  scale_x_continuous(breaks = NULL) + 
  scale_y_continuous(breaks = NULL)
```




